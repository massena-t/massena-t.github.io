<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:linear-gradient(145deg,#0f0f1a 0%,#1a1a2e 50%,#16213e 100%);
  font-family:'IBM Plex Sans',sans-serif;
  display:flex;align-items:center;justify-content:center;
  min-height:100vh;padding:20px;
}
.container{
  width:100%;max-width:980px;
  background:rgba(255,255,255,0.03);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:16px;padding:28px 26px 24px;
  box-shadow:0 16px 64px rgba(0,0,0,0.3);
}
.title{
  font-weight:700;font-size:22px;color:#f0f0f0;
  text-align:center;letter-spacing:-0.02em;margin-bottom:2px;
}
.subtitle{
  font-size:13px;color:rgba(255,255,255,0.45);
  text-align:center;margin-bottom:16px;
}
.controls{
  display:flex;justify-content:center;gap:18px;margin-bottom:16px;
  flex-wrap:wrap;
}
.control{
  font-family:'IBM Plex Mono',monospace;
  font-size:12px;color:rgba(255,255,255,0.7);
}
.control input{
  margin-left:6px;background:#111;border:1px solid rgba(255,255,255,0.15);
  color:#fff;border-radius:6px;padding:4px 6px;font-family:inherit;width:80px;
}
canvas {
  width: 100% !important;
  height: 420px !important;   /* coeffs.html */
}
.annotation{
  font-size:11px;color:rgba(255,255,255,0.35);
  text-align:center;margin-top:10px;
  font-family:'IBM Plex Mono',monospace;
}
.annotation span{color:rgba(255,255,255,0.6)}
</style>
</head>
<body>
<div class="container">
  <div class="title">Newton–Schulz Polynomial Approximation</div>
  <div class="subtitle">Repeated 5th-order polynomial vs true x^(1/p)</div>

  <div class="controls">
    <div class="control">p <input id="pval" type="number" step="0.1" value="2.0"></div>
    <div class="control">iterations <input id="iters" type="number" step="1" value="5"></div>
  </div>

  <canvas id="chart"></canvas>

  <div class="annotation">
    <span>solid</span> = polynomial applied k times &nbsp;&nbsp;·&nbsp;&nbsp;
    <span>dashed</span> = target x<sup>1/p</sup>
  </div>
</div>

<script>
function solveCoeffs(p){
  if(Math.abs(p-1)<1e-10) return [1,0,0];

  const A = [
    [1/3,1/5,1/7,1],
    [1/5,1/7,1/9,1],
    [1/7,1/9,1/11,1],
    [1,1,1,0]
  ];
  const B = [1/(p+2),1/(p+4),1/(p+6),1];

  const M = A.map((row,i)=>row.concat([B[i]]));

  for(let i=0;i<4;i++){
    let max=i;
    for(let j=i+1;j<4;j++)
      if(Math.abs(M[j][i])>Math.abs(M[max][i])) max=j;
    [M[i],M[max]]=[M[max],M[i]];

    const piv=M[i][i];
    for(let k=i;k<5;k++) M[i][k]/=piv;

    for(let j=0;j<4;j++){
      if(j===i) continue;
      const f=M[j][i];
      for(let k=i;k<5;k++) M[j][k]-=f*M[i][k];
    }
  }
  return [M[0][4],M[1][4],M[2][4]];
}

function updateCoeffs(p,iters){
  if(p<=0 || !isFinite(p)) return [1,0,0];
  const q=Math.pow(1/p,1/iters);
  return solveCoeffs(q);
}

function buildData(){
  const p=parseFloat(document.getElementById("pval").value);
  const k=parseInt(document.getElementById("iters").value);

  const [a,b,c]=updateCoeffs(p,k);

  const xs=[];
  const poly=[];
  const target=[];

  for(let i=0;i<=400;i++){
    let x=i/400;
    xs.push(x);

    // apply polynomial k times
    let y=x;
    for(let t=0;t<k;t++){
      y = a*y + b*y**3 + c*y**5;
    }
    poly.push(y);

    // true mapping
    target.push(Math.pow(x,1/p));
  }

  return {xs,poly,target,a,b,c};
}

const ctx=document.getElementById("chart").getContext("2d");

const chart=new Chart(ctx,{
  type:"line",
  data:{
    labels:[],
    datasets:[
      {
        label:"polynomial (k steps)",
        data:[],
        borderColor:"#60a5fa",
        borderWidth:2.6,
        tension:0.25,
        pointRadius:0
      },
      {
        label:"x^(1/p)",
        data:[],
        borderColor:"#f87171",
        borderDash:[7,4],
        borderWidth:2.2,
        tension:0.25,
        pointRadius:0
      }
    ]
  },
  options:{
    responsive:true,
    maintainAspectRatio:false,
    animation:{duration:350,easing:"easeOutQuart"},
    interaction:{mode:"index",intersect:false},
    plugins:{
      legend:{
        labels:{
          color:"rgba(255,255,255,0.75)",
          font:{family:"IBM Plex Mono",size:11}
        }
      },
      tooltip:{
        backgroundColor:"#1a1a2e",
        borderColor:"rgba(255,255,255,0.15)",
        borderWidth:1,
        titleFont:{family:"IBM Plex Mono"},
        bodyFont:{family:"IBM Plex Mono"},
        callbacks:{
          title:(items)=>"x = "+items[0].label
        }
      }
    },
    scales:{
      x:{
        title:{
          display:true,
          text:"x",
          color:"rgba(255,255,255,0.5)"
        },
        ticks:{color:"rgba(255,255,255,0.6)",maxTicksLimit:10},
        grid:{color:"rgba(255,255,255,0.06)"},
        border:{color:"rgba(255,255,255,0.15)"}
      },
      y:{
        title:{
          display:true,
          text:"value",
          color:"rgba(255,255,255,0.5)"
        },
        ticks:{color:"rgba(255,255,255,0.6)"},
        grid:{color:"rgba(255,255,255,0.06)"},
        border:{color:"rgba(255,255,255,0.15)"}
      }
    }
  }
});

function updatePlot(){
  const d=buildData();
  chart.data.labels=d.xs;
  chart.data.datasets[0].data=d.poly;
  chart.data.datasets[1].data=d.target;
  chart.update();
}

document.getElementById("pval").addEventListener("input",updatePlot);
document.getElementById("iters").addEventListener("input",updatePlot);

updatePlot();
</script>
</body>
</html>
