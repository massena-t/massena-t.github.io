<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: linear-gradient(145deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
    font-family: 'IBM Plex Sans', -apple-system, sans-serif;
    display: flex; align-items: center; justify-content: center;
    min-height: 100vh; padding: 20px;
  }
  .container {
    width: 100%; max-width: 920px;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 16px; padding: 32px 28px 24px;
    box-shadow: 0 16px 64px rgba(0,0,0,0.3);
  }
  .title {
    font-weight: 700; font-size: 22px; color: #f0f0f0;
    text-align: center; letter-spacing: -0.02em; margin-bottom: 2px;
  }
  .subtitle {
    font-size: 13px; color: rgba(255,255,255,0.45);
    text-align: center; margin-bottom: 14px;
  }
  .seed-bar {
    display: flex; justify-content: center; gap: 8px;
    margin-bottom: 14px;
  }
  .seed-btn {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px; font-weight: 600;
    padding: 5px 14px; border-radius: 6px;
    border: 1.5px solid rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.04);
    color: rgba(255,255,255,0.55);
    cursor: pointer; transition: all 0.2s;
    user-select: none;
  }
  .seed-btn:hover {
    border-color: rgba(255,255,255,0.3);
    background: rgba(255,255,255,0.08);
  }
  .seed-btn.active {
    border-color: rgba(99,179,237,0.6);
    background: rgba(99,179,237,0.12);
    color: #93c5fd;
  }
  .legend {
    display: flex; justify-content: center; gap: 6px 20px;
    margin-bottom: 20px; flex-wrap: wrap;
  }
  .legend-item {
    display: flex; align-items: center; gap: 7px;
    cursor: pointer; padding: 2px 0; transition: opacity 0.2s;
  }
  .legend-item.dimmed { opacity: 0.25; }
  .legend-line {
    width: 18px; height: 0; border-top: 2.5px solid;
    flex-shrink: 0;
  }
  .legend-line.dashed { border-top-style: dashed; }
  .legend-label {
    font-size: 11px; color: rgba(255,255,255,0.7); font-weight: 500;
    font-family: 'IBM Plex Mono', monospace; white-space: nowrap;
  }
  .annotation {
    font-size: 11px; color: rgba(255,255,255,0.35); text-align: center;
    margin-top: 10px; font-family: 'IBM Plex Mono', monospace;
  }
  .annotation span { color: rgba(255,255,255,0.55); }
  canvas { width: 100% !important; }
</style>
</head>
<body>
<div class="container">
  <div class="title">Optimal p* Value Across Layers</div>
  <div class="subtitle">log scale · click legend to toggle layers · select seeds below</div>
  <div class="seed-bar" id="seedBar"></div>
  <div class="legend" id="legend"></div>
  <canvas id="chart"></canvas>
  <div class="annotation">
    <span>p → 1</span> = SGD-like &nbsp;·&nbsp; <span>p → ∞</span> = Muon-like &nbsp;·&nbsp; p<sub>max</sub> = 650
  </div>
</div>
<script>
const allRuns={"run1":{"steps":[2,5,8,11,14,17,20,23,26,29,32,35,39,42,45,48,51,54,57,60,63,66,69,72,76,79,82,85,88,91,94,97,100,103,106,109,113,116,119,122,125,128,131,134,137,140,143,146],"layers":{"to_patch_embedding.0.weight":[4.41,5.11,5.14,5.38,6.01,5.87,6.65,7.04,6.9,6.87,7.58,7.48,7.46,7.33,7.48,7.68,7.34,7.44,7.03,7.34,7.07,7.19,7.04,7.28,7.23,7.61,7.87,7.59,8.03,7.81,7.51,8.15,8.38,8.27,7.99,8.41,8.69,8.57,8.5,8.38,8.64,8.38,8.74,8.5,8.07,7.89,8.22,8.36],"blocks.0.channel_mlp.net.0.weight":[5.66,5.47,4.62,3.97,3.57,3.24,3.11,3.01,2.93,2.85,2.84,2.82,2.84,2.85,2.83,2.84,2.84,2.88,2.9,2.9,2.92,2.95,3.0,3.04,3.04,3.07,3.04,3.06,3.09,3.12,3.13,3.19,3.19,3.19,3.19,3.2,3.2,3.19,3.19,3.22,3.21,3.19,3.24,3.23,3.21,3.23,3.24,3.23],"blocks.0.channel_mlp.net.2.weight":[6.94,7.0,6.64,6.39,6.58,6.58,7.0,7.44,7.96,8.21,8.6,9.19,9.59,9.97,10.13,10.42,10.84,11.11,11.35,11.58,11.53,11.81,12.38,12.56,12.64,12.73,12.85,12.98,13.45,13.35,13.73,13.86,13.86,13.81,13.58,13.97,14.03,14.2,14.39,14.77,14.9,14.87,15.0,14.92,14.94,14.62,15.07,15.0],"blocks.2.channel_mlp.net.0.weight":[4.81,4.73,5.63,6.96,8.74,10.51,14.19,20.05,32.71,75.18,649.55,648.79,649.63,649.58,649.81,649.98,649.99,649.85,649.76,649.56,649.6,650.0,649.69,649.8,649.79,649.8,650.0,649.6,649.94,649.96,649.96,649.96,649.96,649.85,649.27,649.27,649.58,649.81,649.96,649.68,650.0,649.96,649.86,649.99,649.74,649.75,649.96,649.58],"blocks.2.channel_mlp.net.2.weight":[5.56,6.0,6.53,6.54,6.83,6.8,7.18,7.57,7.99,8.45,8.79,9.5,10.14,10.92,11.47,11.9,12.35,12.64,13.28,13.99,14.6,14.55,14.92,15.18,15.34,16.22,15.99,16.39,16.72,17.24,17.7,17.69,18.02,18.14,17.87,18.42,18.94,19.58,20.04,20.31,20.05,20.04,20.73,20.61,20.73,20.67,21.01,21.11],"blocks.4.channel_mlp.net.0.weight":[4.66,5.42,6.8,8.69,13.87,34.43,649.79,649.71,649.79,649.98,649.75,650.0,650.0,649.96,649.79,649.79,649.79,649.75,649.96,649.81,649.79,650.0,649.81,649.96,649.58,649.79,650.0,649.8,649.96,650.0,649.94,649.89,649.79,650.0,649.84,649.96,649.96,649.89,649.96,649.96,649.74,649.77,649.79,649.79,649.96,649.96,649.79,649.86],"blocks.4.channel_mlp.net.2.weight":[4.98,5.85,7.02,7.99,9.98,11.82,17.56,41.22,649.22,649.68,649.86,649.68,648.16,649.94,649.79,649.79,649.79,649.55,649.79,649.99,649.81,649.68,649.85,649.6,649.68,649.81,649.96,649.79,649.99,649.96,649.81,649.35,649.96,649.76,649.76,649.79,649.94,649.99,649.63,650.0,649.79,649.55,649.89,649.99,649.76,649.56,649.89,649.79],"mlp_head.weight":[639.31,16.11,8.99,7.23,7.14,6.43,6.1,5.86,5.47,5.26,5.0,4.96,4.84,4.71,4.66,4.51,4.44,4.02,4.25,4.25,4.24,4.03,4.03,4.16,4.05,4.1,4.3,4.1,4.08,4.14,4.09,4.07,4.18,4.14,4.05,3.98,3.98,4.13,4.12,4.13,4.17,4.15,4.1,4.14,4.15,3.98,4.12,4.08]}},"run2":{"steps":[2,5,8,11,14,17,20,23,26,29,32,35,39,42,45,48,51,54,57,60,63,66,69,72,76,79,82,85,88,91,94,97,100,103,106,109,113,116,119,122,125,128,131,134,137,140,143,146],"layers":{"to_patch_embedding.0.weight":[4.1,4.23,4.6,5.19,5.5,5.88,6.53,6.57,6.85,6.9,7.27,7.75,7.38,7.68,7.89,7.61,8.13,7.57,7.99,7.62,8.12,7.62,7.7,6.96,6.87,7.3,7.7,7.92,7.67,7.67,7.78,7.89,7.63,7.99,8.08,8.24,8.15,7.67,7.81,8.43,8.98,8.87,8.55,8.82,8.6,8.51,8.29,8.68],"blocks.0.channel_mlp.net.0.weight":[4.0,3.93,3.59,3.38,3.12,2.94,2.88,2.78,2.71,2.66,2.65,2.67,2.65,2.63,2.6,2.63,2.67,2.68,2.72,2.7,2.73,2.74,2.73,2.72,2.72,2.77,2.77,2.79,2.78,2.8,2.81,2.82,2.81,2.85,2.86,2.89,2.91,2.9,2.88,2.89,2.91,2.93,2.95,2.97,2.96,2.96,2.92,2.93],"blocks.0.channel_mlp.net.2.weight":[5.71,6.12,5.87,5.77,5.89,6.04,6.38,6.64,7.04,7.52,7.81,8.11,8.35,8.61,8.83,9.14,9.43,9.66,9.76,9.9,10.14,10.39,10.57,10.51,10.66,10.66,10.9,10.92,11.07,11.19,11.11,11.45,11.44,11.42,11.45,11.71,11.62,11.46,11.8,11.88,11.85,11.64,11.82,12.01,12.0,11.81,12.0,12.1],"blocks.2.channel_mlp.net.0.weight":[4.16,4.74,5.32,6.59,9.0,11.99,19.54,32.75,166.67,649.58,649.6,648.21,649.96,649.55,649.8,649.79,649.98,649.63,649.68,649.79,649.76,649.8,649.77,649.58,649.8,649.75,649.6,649.96,649.75,649.79,649.79,649.96,649.56,649.96,649.96,649.76,649.96,649.81,649.96,649.93,649.79,649.81,649.96,649.74,649.94,649.6,649.79,649.79],"blocks.2.channel_mlp.net.2.weight":[5.29,6.37,6.8,7.04,7.62,8.44,10.1,11.2,13.72,17.56,21.11,25.33,30.36,37.42,51.85,59.81,77.47,101.58,146.26,354.8,639.45,646.96,639.31,646.95,649.55,648.89,649.27,649.76,647.25,649.75,648.56,649.26,648.2,646.92,649.63,649.79,649.76,649.75,649.75,649.56,648.34,649.76,650.0,650.0,649.77,649.96,649.27,647.91],"blocks.4.channel_mlp.net.0.weight":[4.13,4.91,5.43,6.31,7.78,9.98,15.18,30.36,645.11,649.8,649.56,649.94,649.8,649.93,650.0,649.81,649.79,650.0,649.56,649.76,649.81,649.6,649.96,649.96,649.96,649.94,649.79,649.96,649.8,649.76,649.79,649.85,649.81,649.58,649.99,649.96,649.76,649.79,649.76,649.6,649.79,649.96,649.81,649.74,649.99,649.99,649.79,649.6],"blocks.4.channel_mlp.net.2.weight":[4.19,4.9,5.55,6.2,7.14,8.38,10.79,13.01,19.15,28.21,41.11,65.43,90.73,164.18,268.96,442.71,646.68,612.84,646.76,589.77,641.17,638.86,648.79,645.09,645.14,544.35,639.31,649.07,581.35,640.04,334.21,533.76,258.19,318.79,334.52,487.28,326.8,165.21,195.78,294.13,190.04,190.36,232.34,189.88,238.66,167.08,223.98,268.83],"mlp_head.weight":[636.96,14.04,8.89,7.48,6.9,6.29,5.94,5.42,5.08,4.96,4.47,4.42,4.29,4.19,4.06,4.03,3.98,3.94,3.88,3.88,3.84,3.96,3.88,3.79,3.78,3.66,3.8,3.76,3.75,3.8,3.84,3.88,3.83,3.92,3.9,3.8,3.8,3.84,3.88,3.84,3.71,3.78,3.94,3.88,3.84,3.87,4.02,4.12]}},"run3":{"steps":[2,5,8,11,14,17,20,23,26,29,32,35,39,42,45,48,51,54,57,60,63,66,69,72,76,79,82,85,88,91,94,97,100,103,106,109,113,116,119,122,125,128,131,134,137,140,143,146],"layers":{"to_patch_embedding.0.weight":[2.66,4.01,4.49,5.25,5.48,5.88,5.91,6.38,6.49,6.92,6.65,6.93,7.02,7.44,7.52,7.35,6.91,7.38,7.93,7.68,8.18,7.48,7.39,7.3,7.22,7.66,7.2,7.81,7.89,8.19,7.7,7.72,7.58,8.14,8.52,8.51,8.38,8.44,8.35,8.36,8.89,8.94,8.79,8.2,8.38,8.22,8.41,8.51],"blocks.0.channel_mlp.net.0.weight":[2.96,3.84,3.78,3.64,3.31,3.14,2.96,2.86,2.79,2.75,2.71,2.72,2.76,2.76,2.81,2.85,2.88,2.9,2.91,2.92,2.95,3.0,3.02,3.04,3.09,3.09,3.07,3.12,3.13,3.17,3.17,3.15,3.15,3.2,3.17,3.2,3.23,3.25,3.27,3.25,3.25,3.27,3.25,3.27,3.22,3.22,3.22,3.21],"blocks.0.channel_mlp.net.2.weight":[4.74,5.83,6.09,6.29,6.49,6.8,7.17,7.66,7.91,8.36,8.82,9.39,9.81,10.2,10.53,10.93,11.34,11.59,11.61,11.83,12.22,12.98,13.28,13.04,13.81,13.69,14.12,14.12,14.7,14.62,14.63,14.79,15.05,15.52,15.34,15.9,15.64,15.63,15.63,15.18,15.42,15.63,15.54,15.63,15.9,15.98,16.05,15.63],"blocks.2.channel_mlp.net.0.weight":[3.43,4.03,4.57,5.44,6.46,7.83,10.06,13.47,18.37,31.49,91.62,639.16,648.0,648.4,648.38,649.76,648.13,649.6,649.69,649.58,649.96,649.88,649.56,649.81,649.76,649.6,649.79,649.77,649.65,649.77,649.77,649.86,649.79,649.72,649.6,649.6,649.79,649.77,649.79,649.86,649.79,649.79,649.99,649.76,649.86,649.66,649.76,649.58],"blocks.2.channel_mlp.net.2.weight":[4.69,5.32,5.82,6.0,6.22,6.57,7.02,7.48,8.18,8.88,10.03,11.76,12.99,14.71,16.32,18.42,20.04,21.93,22.61,26.39,28.35,30.36,31.64,33.82,35.78,39.08,47.08,50.45,50.46,53.53,55.23,63.04,72.13,75.38,76.14,85.12,98.42,105.38,111.63,136.01,145.7,149.51,199.12,220.28,262.91,239.56,304.63,285.24],"blocks.4.channel_mlp.net.0.weight":[4.69,5.38,6.13,7.78,10.47,15.05,27.18,105.38,649.69,649.76,649.75,650.0,649.74,649.69,649.86,649.96,649.75,649.96,649.96,649.56,649.69,649.66,649.56,649.79,649.96,649.96,649.96,650.0,649.76,649.6,649.79,649.79,649.76,649.56,649.6,649.58,649.76,649.79,649.94,649.99,649.98,649.96,649.6,649.94,649.77,648.83,649.58,649.99],"blocks.4.channel_mlp.net.2.weight":[4.8,5.32,6.14,6.99,8.36,10.44,13.81,18.85,27.12,41.38,77.86,426.58,646.92,645.04,645.02,646.92,648.1,649.79,647.71,645.04,648.24,648.26,649.27,649.56,648.1,648.36,649.23,649.8,646.95,648.79,645.58,648.67,648.14,649.99,649.82,648.31,649.79,648.26,649.76,649.81,645.02,648.15,648.12,649.81,649.79,649.79,649.54,648.79],"mlp_head.weight":[649.96,17.96,9.66,8.21,6.9,6.37,5.95,5.41,5.26,4.99,4.96,4.84,4.67,4.5,4.51,4.38,4.26,4.24,4.25,4.26,4.3,4.22,4.15,4.32,4.24,4.2,4.15,4.12,4.21,4.08,4.08,4.23,4.3,4.37,4.38,4.43,4.47,4.43,4.43,4.25,4.36,4.25,4.33,4.35,4.4,4.46,4.57,4.48]}}};

const steps=allRuns.run1.steps;
const layerKeys=Object.keys(allRuns.run1.layers);
const meanLayers={};
layerKeys.forEach(k=>{meanLayers[k]=steps.map((_,i)=>{
  const v=[allRuns.run1.layers[k][i],allRuns.run2.layers[k][i],allRuns.run3.layers[k][i]];
  return Math.round((v[0]+v[1]+v[2])/3*100)/100;
});});
allRuns["mean"]={steps,layers:meanLayers};

const layerConfig=[
  {key:"to_patch_embedding.0.weight",label:"Patch Embed",color:"#f59e0b",dash:false},
  {key:"blocks.0.channel_mlp.net.0.weight",label:"Block 0 · fc1",color:"#60a5fa",dash:false},
  {key:"blocks.0.channel_mlp.net.2.weight",label:"Block 0 · fc2",color:"#60a5fa",dash:true},
  {key:"blocks.2.channel_mlp.net.0.weight",label:"Block 2 · fc1",color:"#f87171",dash:false},
  {key:"blocks.2.channel_mlp.net.2.weight",label:"Block 2 · fc2",color:"#f87171",dash:true},
  {key:"blocks.4.channel_mlp.net.0.weight",label:"Block 4 · fc1",color:"#4ade80",dash:false},
  {key:"blocks.4.channel_mlp.net.2.weight",label:"Block 4 · fc2",color:"#4ade80",dash:true},
  {key:"mlp_head.weight",label:"Classifier",color:"#c084fc",dash:false},
];
const seedOptions=[
  {id:"mean",label:"Mean"},
  {id:"run1",label:"Seed 1"},
  {id:"run2",label:"Seed 2"},
  {id:"run3",label:"Seed 3"},
];

let activeSeed="mean";
let hiddenLayers=new Set();

function buildDatasets(runId){
  const run=allRuns[runId];
  return layerConfig.map((cfg,i)=>({
    label:cfg.label,
    data:run.layers[cfg.key],
    borderColor:cfg.color,
    backgroundColor:cfg.color,
    borderWidth:2.2,
    borderDash:cfg.dash?[6,3]:[],
    pointRadius:1.5,
    pointHoverRadius:5,
    pointHoverBackgroundColor:cfg.color,
    pointHoverBorderColor:"#1a1a2e",
    pointHoverBorderWidth:2,
    tension:0.3,
    fill:false,
    hidden:hiddenLayers.has(i),
  }));
}

const ctx=document.getElementById("chart").getContext("2d");
const chart=new Chart(ctx,{
  type:"line",
  data:{labels:steps,datasets:buildDatasets("mean")},
  options:{
    responsive:true,maintainAspectRatio:true,aspectRatio:1.65,
    animation:{duration:400,easing:"easeOutQuart"},
    interaction:{mode:"index",intersect:false},
    plugins:{
      legend:{display:false},
      tooltip:{
        backgroundColor:"#1a1a2e",
        borderColor:"rgba(255,255,255,0.12)",borderWidth:1,
        titleFont:{family:"'IBM Plex Mono'",size:12,weight:"600"},
        bodyFont:{family:"'IBM Plex Mono'",size:10.5},
        titleColor:"#fff",bodyColor:"#e0e0e0",
        padding:12,cornerRadius:8,
        callbacks:{
          title:(items)=>"Step "+items[0].label,
          label:(item)=>" "+item.dataset.label+":  p = "+item.raw.toFixed(1),
          labelColor:(item)=>({
            borderColor:item.dataset.borderColor,
            backgroundColor:item.dataset.borderColor,
            borderWidth:2,borderRadius:2,
          }),
        },
      },
    },
    scales:{
      x:{
        title:{display:true,text:"Training Step",
          color:"rgba(255,255,255,0.5)",
          font:{family:"'IBM Plex Sans'",size:12,weight:"500"},
          padding:{top:8}},
        ticks:{color:"rgba(255,255,255,0.55)",
          font:{family:"'IBM Plex Mono'",size:10},maxTicksLimit:12},
        grid:{color:"rgba(255,255,255,0.06)"},
        border:{color:"rgba(255,255,255,0.12)"},
      },
      y:{
        type:"logarithmic",
        title:{display:true,text:"Optimal p*  (log scale)",
          color:"rgba(255,255,255,0.5)",
          font:{family:"'IBM Plex Sans'",size:12,weight:"500"},
          padding:{bottom:8}},
        min:2,max:800,
        ticks:{color:"rgba(255,255,255,0.55)",
          font:{family:"'IBM Plex Mono'",size:10},
          callback:function(val){
            if([2,3,5,10,20,50,100,200,650].includes(val))return val;
            return "";
          }},
        grid:{color:"rgba(255,255,255,0.06)",borderDash:[3,3]},
        border:{color:"rgba(255,255,255,0.12)"},
      },
    },
  },
});

/* seed buttons */
function switchSeed(runId){
  activeSeed=runId;
  chart.data.datasets=buildDatasets(runId);
  chart.update();
  document.querySelectorAll(".seed-btn").forEach(b=>
    b.classList.toggle("active",b.dataset.run===runId));
}
const seedBar=document.getElementById("seedBar");
seedOptions.forEach(opt=>{
  const btn=document.createElement("button");
  btn.className="seed-btn"+(opt.id==="mean"?" active":"");
  btn.textContent=opt.label;
  btn.dataset.run=opt.id;
  btn.addEventListener("click",()=>switchSeed(opt.id));
  seedBar.appendChild(btn);
});

/* layer legend */
const legendEl=document.getElementById("legend");
layerConfig.forEach((cfg,i)=>{
  const item=document.createElement("div");
  item.className="legend-item";
  const line=document.createElement("div");
  line.className="legend-line"+(cfg.dash?" dashed":"");
  line.style.borderTopColor=cfg.color;
  const label=document.createElement("span");
  label.className="legend-label";
  label.textContent=cfg.label;
  item.appendChild(line);
  item.appendChild(label);
  legendEl.appendChild(item);
  item.addEventListener("click",function(){
    if(hiddenLayers.has(i))hiddenLayers.delete(i);
    else hiddenLayers.add(i);
    item.classList.toggle("dimmed");
    chart.data.datasets[i].hidden=hiddenLayers.has(i);
    chart.update();
  });
});
</script>
</body>
</html>
